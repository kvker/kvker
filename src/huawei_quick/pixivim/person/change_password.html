<!doctype html>
<html lang="zh">

<head>
  <meta charset="utf-8">
  <meta name="keywords" content="pixiv, P站, acg">
  <meta name="description" content="在线分享P站美图工具">
  <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0,maximum-scale=3,minimum-scale=1">
  <meta name="apple-mobile-web-app-title" content="pixivim">
  <title>Change Pas - Pixivim</title>
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="../css/custom.css">
  <link rel="stylesheet" href="../css/pixivim.css">
  <style>
    input,
    button {
      width: 200px;
      height: 32px;
      border-radius: 8px;
    }
  </style>
</head>

<body>
  <main class="flex-c jcc aic">
    <form class="flex-c jcc aic" onsubmit="submitForm(event)">
      <input name="password" class="my-10" placeholder="请输入新密码" required>
      <button>提交</button>
    </form>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.18.0/js/md5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.2.0/dist/av-min.js"></script>
  <script src="../../js/av.js"></script>
  <script src="../js/pixivim.js"></script>
  <script src="../js/wc.js"></script>
  <script>
    let form = document.querySelector('form')

    function submitForm(e) {
      e.preventDefault()
      startLoading()
      let password = md5(form.password.value)
      av.currentUser().save({ password }).then(ret => {
        alert('修改成功')
        av.logout().then(_ => {
          location.replace('../person.html')
        })
      }).catch(error => {
        alert(error.message)
      }).finally(_ => {
        endLoading()
      })
    }
  </script>
</body>

</html>